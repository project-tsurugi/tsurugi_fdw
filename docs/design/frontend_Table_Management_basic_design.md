【Project-Tsurugi Internal Use Only】

# Tsurugi テーブル管理機能 基本設計書

2022.06.17 NEC

## 1. 機能

Tsurugiのテーブル管理機能は以下の二種類のテーブルを定義/削除/変更(将来拡張)する機能を提供する。

- OLTPテーブル
- 外部テーブル

### 1) OLTPテーブル制御

  Tsurugiでは管理者または利用者がOLTPのテーブルを直接制御することができないため、PostgreSQLからOLTPのテーブルを制御できるようにする。
  
  | # | 機能名 | 説明 | コマンド名 | 備考 |
  |---|---|---|---|---|
  |1. | OLTPテーブル定義機能 | OLTPテーブルを定義する | CREATE TABLE | - |
  |2. | OLTPテーブル削除機能 | OLTPテーブルを削除する | DROP TABLE | - |
  |3. | OLTPテーブル変更機能 | OLTPテーブルの属性を変更する | ALTER TABLE | 将来拡張 |

### 2) 外部テーブル制御

  OLTPに作成したテーブルへはPostgreSQLの外部データラッパ(FDW)を通してアクセスできるようにする。

  | # | 機能名 | 説明 | コマンド名 | 備考 |
  |---|---|---|---|---|
  |1. | 外部テーブル定義機能 | 外部テーブルを定義する | CREATE FOREIGN TABLE | - |
  |2. | 外部テーブル削除機能 | 外部テーブルを削除する | DROP FOREIGN TABLE | - |
  |3. | 外部テーブル変更機能 | 外部テーブルの属性を変更する | ALTER FOREIGN TABLE | 将来拡張 |

## 2. ユースケース

### 1) PostgreSQL(FDW)のセットアップ

- 管理者は、テーブル管理機能を提供する外部データラッパをインストールする (CREATE EXTENTION)
- 管理者は、OLTPを指す外部サーバを定義する (CREATE SERVER)
- 管理者は、Tsurugiのテーブル空間を定義する (CREATE TABLESPACE)

### 2) テーブルの定義

- 管理者は、OLTPテーブルを定義する
- 管理者は、OLTPテーブルを指す外部テーブル定義する

### 3) テーブルへのアクセス

- 利用者は、外部テーブルを通してOLTPテーブルへアクセスする (SELECT, INSERT, UPDATE, ...)

### 4) テーブルの編集

- 管理者は、必要に応じてOLTPテーブルを編集する
- 管理者は、必要に応じてOLTPテーブルを指す外部テーブル編集する

### 5) テーブルの削除

- 管理者は、必要に応じてOLTPテーブルを削除する
- 管理者は、必要に応じてOLTPテーブルを指す外部テーブル削除する

## 3. 実現方法

### 1) 基本方針

- テーブルの制御は、PostgreSQLの仕様に準拠する
- OLTPのテーブル制御は、OLTPが提供するStub APIを利用する
- OLTPとの通信は、統合メタデータ管理基盤(message-broker)を利用する
- OLTPテーブルのメタデータ管理は、統合メタデータ管理基盤(metadata-manager)を利用する

### 2) モジュール構成

- PostgreSQL(FDW)とOLTP、統合メタデータ管理基盤の関係は以下のとおりである。

※ 構成図 記載予定

### 3) OLTPテーブル定義

- 管理者からの要求により、PostgreSQLのシステムカタログと統合メタデータ管理基盤にメタデータを登録する
- OLTPへのテーブル定義要求は、統合メタデータ管理基盤経由で要求する

### 4) OLTPテーブル削除

- 管理者からの要求により、PostgreSQLのシステムカタログからメタデータを削除する
- 統合メタデータ管理基盤に登録したメタデータの登録を解除する(削除しない)
- OLTPへのテーブル削除要求は、統合メタデータ管理基盤経由で要求する

### 5) OLTPテーブル編集

- 非サポート(将来拡張)とする

### 6) 外部テーブル定義/削除/編集

- PostgreSQLの外部データラッパの仕様に準じて実現する
- 外部テーブルの編集は非サポート(将来拡張)とする


以上
