# 統合メタデータ管理基盤API案
2020.01.24 NEC 岡田 耕平

本ドキュメントは、実施項目「II-①統合メタデータ管理基盤」で実現する統合メタデータ管理基盤を利用するためのAPIの設計方針とAPI仕様の概要について記述する。

## 統合メタデータ管理基盤
* 統合メタデータ管理基盤は、NEDO DBを管理、運用するために必要なメタデータを分類、整理して管理する。
* NEDO DBではメタデータを以下の2種類に分け、統合メタデータ管理基盤では主に1.のコアメタデータについてデータ構造やAPIを設計する。
1. コアメタデータ(仮)
   * テーブルやカラムなどのデータベースシステムとして動作するために必要なメタデータ
2. プライベートメタデータ(仮)
   * 各コンポーネント固有の設定情報など

## メタデータ分類
* 統合メタデータ管理基盤はメタデータを分類ごとに分けて管理する。
* 分類ごとに管理用テーブル（メタデータテーブル）を用意し、各コンポーネントはメタデータテーブルの単位で統合メタデータ管理基盤にアクセスする。
* 各分類のメタデータテーブルの仕様はNECが設計し、プロジェクト内に展開する。
### V1でのメタデータの分類 ※変更の可能性あり
* テーブルメタデータ
* カラムメタデータ
* 制約メタデータ
* インデックスメタデータ？

## メタデータAPI基本アーキテクチャ
* 統合メタデータ管理基盤は、メタデータを格納するために boost の boost::property_tree ライブラリを使用する。
* 統合メタデータ管理基盤は、メタデータテーブル上のメタデータをproperty_treeオブジェクトに格納して各コンポーネントに提供する。
* 各コンポーネントは、property_treeオブジェクトにメタデータを格納し、統合メタデータ管理基盤にメタデータの追加や更新を依頼する。

## Metadataクラス（基底クラス）
* メタデータを分類(tableやcolumnなど)ごとにアクセスするためのクラス。
* 実際にはmetadataクラスから派生したクラスを利用してメタデータにアクセスする。
* 派生クラスでは管理するメタデータの内容に合わせてメソッドが実装される（必ずしも基底クラスのメソッドがすべて派生クラスで実装されるわけではない）。

### メソッド一覧

|メソッド名|説明|
|:---------|:---|
|load()|その分類のメタデータテーブル上のすべてのメタデータをproperty_treeオブジェクトに読み込んで返す。|
|save()|property_treeオブジェクトに格納されたメタデータでメタデータテーブルを上書きする。|
|add()|分類ごとに定義された単位でメタデータを追加する（tableであれば１テーブル、columnであれば１カラム）。|
|get()|分類ごとに定義された単位でメタデータを読み込む（tableであれば１テーブル、columnであれば１カラム）。|
|set()|分類ごとに定義された単位でメタデータを書き込む（tableであれば１テーブル、columnであれば１カラム）。|
|remove()|分類ごとに定義された単位でメタデータを削除する（tableであれば１テーブル、columnであれば１カラム）。|
|enum_id()|その分類のメタデータテーブルにID列が存在する場合は、すべてのIDを列挙する。|

## TableMetadataクラス
テーブルに関するメタデータを管理する。

### メソッド一覧
|メソッド名|説明|
|:---------|:---|
|load()|tableメタデータテーブル上のすべてのメタデータをproperty_treeオブジェクトに読み込んで返す。|
|save()|property_treeオブジェクトに格納されたメタデータでtableメタデータテーブルを上書きする。|
|add()|テーブルを１つ追加する。|
|get()|指定したIDまたは名前を持つテーブルのメタデータを取得する。|
|set()|指定したIDまたは名前を持つテーブルのメタデータを更新する。|
|remove()|指定したIDまたは名前を持つテーブルのメタデータを削除する。|
|enum_id()|tableメタデータテーブル上のすべてのIDを列挙する。|

## ColumnMetadataクラス
カラムに関するメタデータを管理する。

### メソッド一覧
|メソッド名|説明|
|:---------|:---|
|load()|columnメタデータテーブル上のすべてのメタデータをproperty_treeオブジェクトに読み込んで返す。|
|save()|property_treeオブジェクトに格納されたメタデータでcolumnメタデータテーブルを上書きする。|
|add()|カラムを１つ追加する。|
|get()|指定したIDまたは名前を持つカラムのメタデータを取得する。|
|set()|指定したIDまたは名前を持つカラムのメタデータを更新する。|
|remove()|指定したIDまたは名前を持つカラムのメタデータを削除する。|
|enum_id()|columnメタデータテーブル上のすべてのIDを列挙する。|

## ConstraintMetadataクラス
制約に関するメタデータを管理する。

### メソッド一覧
|メソッド名|説明|
|:---------|:---|
|load()|constraintメタデータテーブル上のすべてのメタデータをproperty_treeオブジェクトに読み込んで返す。|
|save()|property_treeオブジェクトに格納されたメタデータでconstraintメタデータテーブルを上書きする。|
|add()|制約を１つ追加する。|
|get()|指定したIDまたは名前を持つ制約のメタデータを取得する。|
|set()|指定したIDまたは名前を持つ制約のメタデータを更新する。|
|remove()|指定したIDまたは名前を持つ制約のメタデータを削除する。|
|enum_id()|constraintメタデータテーブル上のすべてのIDを列挙する。|


以上
