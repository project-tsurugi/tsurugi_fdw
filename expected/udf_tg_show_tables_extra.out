/* Test case: extra path - UDF tg_show_tables() */
-- Test case: 3-4-1
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE udf_test_table_1 (id INT, name CHAR(64))
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', False);
                                                          tg_show_tables                                                          
----------------------------------------------------------------------------------------------------------------------------------
 {"remote_schema":{"remote_schema":"tg_schema","server_name":"tsurugidb","mode":"summary","tables_on_remote_schema":{"count":1}}}
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', FALSE);
                                                          tg_show_tables                                                          
----------------------------------------------------------------------------------------------------------------------------------
 {"remote_schema":{"remote_schema":"tg_schema","server_name":"tsurugidb","mode":"summary","tables_on_remote_schema":{"count":1}}}
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', True);
            tg_show_tables             
---------------------------------------
 {                                    +
     "remote_schema": {               +
         "remote_schema": "tg_schema",+
         "server_name": "tsurugidb",  +
         "mode": "summary",           +
         "tables_on_remote_schema": { +
             "count": 1               +
         }                            +
     }                                +
 }
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', TRUE);
            tg_show_tables             
---------------------------------------
 {                                    +
     "remote_schema": {               +
         "remote_schema": "tg_schema",+
         "server_name": "tsurugidb",  +
         "mode": "summary",           +
         "tables_on_remote_schema": { +
             "count": 1               +
         }                            +
     }                                +
 }
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE udf_test_table_1', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 3-4-2
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE udf_test_table_1 (id INT, name CHAR(64))
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', 't');
            tg_show_tables             
---------------------------------------
 {                                    +
     "remote_schema": {               +
         "remote_schema": "tg_schema",+
         "server_name": "tsurugidb",  +
         "mode": "summary",           +
         "tables_on_remote_schema": { +
             "count": 1               +
         }                            +
     }                                +
 }
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', 'yes');
            tg_show_tables             
---------------------------------------
 {                                    +
     "remote_schema": {               +
         "remote_schema": "tg_schema",+
         "server_name": "tsurugidb",  +
         "mode": "summary",           +
         "tables_on_remote_schema": { +
             "count": 1               +
         }                            +
     }                                +
 }
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', 'y');
            tg_show_tables             
---------------------------------------
 {                                    +
     "remote_schema": {               +
         "remote_schema": "tg_schema",+
         "server_name": "tsurugidb",  +
         "mode": "summary",           +
         "tables_on_remote_schema": { +
             "count": 1               +
         }                            +
     }                                +
 }
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', 'on');
            tg_show_tables             
---------------------------------------
 {                                    +
     "remote_schema": {               +
         "remote_schema": "tg_schema",+
         "server_name": "tsurugidb",  +
         "mode": "summary",           +
         "tables_on_remote_schema": { +
             "count": 1               +
         }                            +
     }                                +
 }
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', '1');
            tg_show_tables             
---------------------------------------
 {                                    +
     "remote_schema": {               +
         "remote_schema": "tg_schema",+
         "server_name": "tsurugidb",  +
         "mode": "summary",           +
         "tables_on_remote_schema": { +
             "count": 1               +
         }                            +
     }                                +
 }
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', 'f');
                                                          tg_show_tables                                                          
----------------------------------------------------------------------------------------------------------------------------------
 {"remote_schema":{"remote_schema":"tg_schema","server_name":"tsurugidb","mode":"summary","tables_on_remote_schema":{"count":1}}}
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', 'no');
                                                          tg_show_tables                                                          
----------------------------------------------------------------------------------------------------------------------------------
 {"remote_schema":{"remote_schema":"tg_schema","server_name":"tsurugidb","mode":"summary","tables_on_remote_schema":{"count":1}}}
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', 'n');
                                                          tg_show_tables                                                          
----------------------------------------------------------------------------------------------------------------------------------
 {"remote_schema":{"remote_schema":"tg_schema","server_name":"tsurugidb","mode":"summary","tables_on_remote_schema":{"count":1}}}
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', 'off');
                                                          tg_show_tables                                                          
----------------------------------------------------------------------------------------------------------------------------------
 {"remote_schema":{"remote_schema":"tg_schema","server_name":"tsurugidb","mode":"summary","tables_on_remote_schema":{"count":1}}}
(1 row)

SELECT tg_show_tables('tg_schema', 'tsurugidb', 'summary', '0');
                                                          tg_show_tables                                                          
----------------------------------------------------------------------------------------------------------------------------------
 {"remote_schema":{"remote_schema":"tg_schema","server_name":"tsurugidb","mode":"summary","tables_on_remote_schema":{"count":1}}}
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE udf_test_table_1', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 7-1-1
--- Test setup: DDL of the Tsurugi
DO $$
DECLARE
  TABLE_MAX CONSTANT INT := 100;
  COLUMN_MAX CONSTANT INT := 50;
  columns_def TEXT;
  i INT;
BEGIN
  SELECT string_agg(format('col_%s INT', n), ', ')
    INTO columns_def
  FROM generate_series(1, COLUMN_MAX) n;

  FOR i IN 1..TABLE_MAX LOOP
    EXECUTE format(
      'SELECT tg_execute_ddl(''CREATE TABLE IF NOT EXISTS udf_test_table_%s (%s)'', ''tsurugidb'')',
      to_char(i, 'FM0000'), columns_def);
  END LOOP;
END $$;
--- Test
SELECT tg_show_tables('tg_schema', 'tsurugidb', 'detail', true);
             tg_show_tables             
----------------------------------------
 {                                     +
     "remote_schema": {                +
         "remote_schema": "tg_schema", +
         "server_name": "tsurugidb",   +
         "mode": "detail",             +
         "tables_on_remote_schema": {  +
             "count": 100,             +
             "list": [                 +
                 "udf_test_table_0001",+
                 "udf_test_table_0002",+
                 "udf_test_table_0003",+
                 "udf_test_table_0004",+
                 "udf_test_table_0005",+
                 "udf_test_table_0006",+
                 "udf_test_table_0007",+
                 "udf_test_table_0008",+
                 "udf_test_table_0009",+
                 "udf_test_table_0010",+
                 "udf_test_table_0011",+
                 "udf_test_table_0012",+
                 "udf_test_table_0013",+
                 "udf_test_table_0014",+
                 "udf_test_table_0015",+
                 "udf_test_table_0016",+
                 "udf_test_table_0017",+
                 "udf_test_table_0018",+
                 "udf_test_table_0019",+
                 "udf_test_table_0020",+
                 "udf_test_table_0021",+
                 "udf_test_table_0022",+
                 "udf_test_table_0023",+
                 "udf_test_table_0024",+
                 "udf_test_table_0025",+
                 "udf_test_table_0026",+
                 "udf_test_table_0027",+
                 "udf_test_table_0028",+
                 "udf_test_table_0029",+
                 "udf_test_table_0030",+
                 "udf_test_table_0031",+
                 "udf_test_table_0032",+
                 "udf_test_table_0033",+
                 "udf_test_table_0034",+
                 "udf_test_table_0035",+
                 "udf_test_table_0036",+
                 "udf_test_table_0037",+
                 "udf_test_table_0038",+
                 "udf_test_table_0039",+
                 "udf_test_table_0040",+
                 "udf_test_table_0041",+
                 "udf_test_table_0042",+
                 "udf_test_table_0043",+
                 "udf_test_table_0044",+
                 "udf_test_table_0045",+
                 "udf_test_table_0046",+
                 "udf_test_table_0047",+
                 "udf_test_table_0048",+
                 "udf_test_table_0049",+
                 "udf_test_table_0050",+
                 "udf_test_table_0051",+
                 "udf_test_table_0052",+
                 "udf_test_table_0053",+
                 "udf_test_table_0054",+
                 "udf_test_table_0055",+
                 "udf_test_table_0056",+
                 "udf_test_table_0057",+
                 "udf_test_table_0058",+
                 "udf_test_table_0059",+
                 "udf_test_table_0060",+
                 "udf_test_table_0061",+
                 "udf_test_table_0062",+
                 "udf_test_table_0063",+
                 "udf_test_table_0064",+
                 "udf_test_table_0065",+
                 "udf_test_table_0066",+
                 "udf_test_table_0067",+
                 "udf_test_table_0068",+
                 "udf_test_table_0069",+
                 "udf_test_table_0070",+
                 "udf_test_table_0071",+
                 "udf_test_table_0072",+
                 "udf_test_table_0073",+
                 "udf_test_table_0074",+
                 "udf_test_table_0075",+
                 "udf_test_table_0076",+
                 "udf_test_table_0077",+
                 "udf_test_table_0078",+
                 "udf_test_table_0079",+
                 "udf_test_table_0080",+
                 "udf_test_table_0081",+
                 "udf_test_table_0082",+
                 "udf_test_table_0083",+
                 "udf_test_table_0084",+
                 "udf_test_table_0085",+
                 "udf_test_table_0086",+
                 "udf_test_table_0087",+
                 "udf_test_table_0088",+
                 "udf_test_table_0089",+
                 "udf_test_table_0090",+
                 "udf_test_table_0091",+
                 "udf_test_table_0092",+
                 "udf_test_table_0093",+
                 "udf_test_table_0094",+
                 "udf_test_table_0095",+
                 "udf_test_table_0096",+
                 "udf_test_table_0097",+
                 "udf_test_table_0098",+
                 "udf_test_table_0099",+
                 "udf_test_table_0100" +
             ]                         +
         }                             +
     }                                 +
 }
(1 row)

--- Test teardown: DDL of the Tsurugi/PostgreSQL
DO $$
DECLARE
  TABLE_MAX CONSTANT INT := 100;
  i INT;
BEGIN
  FOR i IN 1..TABLE_MAX LOOP
    EXECUTE format(
      'SELECT tg_execute_ddl(''DROP TABLE IF EXISTS udf_test_table_%s'', ''tsurugidb'')',
      to_char(i, 'FM0000'));
  END LOOP;
END $$;
