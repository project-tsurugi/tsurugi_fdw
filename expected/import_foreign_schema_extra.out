/* Test case: extra path - IMPORT FOREIGN SCHEMA functionality */
-- Test setup: PostgreSQL environment
SET datestyle TO ISO, YMD;
SET timezone TO 'Asia/Tokyo';
-- Test setup: PostgreSQL functions
CREATE OR REPLACE FUNCTION drop_foreign_tables()
RETURNS text AS $$
DECLARE
  r RECORD;
BEGIN
  FOR r IN
    SELECT n.nspname, c.relname
    FROM pg_foreign_table ft
      JOIN pg_class c ON c.oid = ft.ftrelid
      JOIN pg_namespace n ON n.oid = c.relnamespace
  LOOP
    EXECUTE format('DROP FOREIGN TABLE %I.%I;', r.nspname, r.relname);
  END LOOP;
  RETURN 'DROP FOREIGN TABLE';
END;
$$ LANGUAGE plpgsql;
-- Test case: 3-1-1_4
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_type_num (
    col_int INT,
    col_bigint BIGINT,
    col_real REAL,
    col_float FLOAT,
    col_double DOUBLE,
    col_double_precision DOUBLE PRECISION,
    col_decimal DECIMAL,
    col_decimal_p DECIMAL(2),
    col_decimal_ps DECIMAL(3, 2),
    col_decimal_max DECIMAL(*)
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_type_num
         List of foreign tables
 Schema |       Table       |  Server   
--------+-------------------+-----------
 public | fdw_test_type_num | tsurugidb
(1 row)

\d fdw_test_type_num
                        Foreign table "public.fdw_test_type_num"
        Column        |       Type       | Collation | Nullable | Default | FDW options 
----------------------+------------------+-----------+----------+---------+-------------
 col_int              | integer          |           |          |         | 
 col_bigint           | bigint           |           |          |         | 
 col_real             | real             |           |          |         | 
 col_float            | real             |           |          |         | 
 col_double           | double precision |           |          |         | 
 col_double_precision | double precision |           |          |         | 
 col_decimal          | numeric          |           |          |         | 
 col_decimal_p        | numeric          |           |          |         | 
 col_decimal_ps       | numeric          |           |          |         | 
 col_decimal_max      | numeric          |           |          |         | 
Server: tsurugidb

INSERT INTO fdw_test_type_num 
  (col_int, col_bigint, col_real, col_float, col_double, col_double_precision,
    col_decimal, col_decimal_p, col_decimal_ps, col_decimal_max)
  VALUES (1, 2, 3.33, 4.44, 5.55, 6.66, 77777, 88, 9.99, 1000);
SELECT * FROM fdw_test_type_num;
 col_int | col_bigint | col_real | col_float | col_double | col_double_precision | col_decimal | col_decimal_p | col_decimal_ps | col_decimal_max 
---------+------------+----------+-----------+------------+----------------------+-------------+---------------+----------------+-----------------
       1 |          2 |     3.33 |      4.44 |       5.55 |                 6.66 |       77777 |            88 |           9.99 |            1000
(1 row)

UPDATE fdw_test_type_num
  SET col_int = 2, col_bigint = 3, col_real = 4.567, col_float = 5.678,
      col_double = 6.78901, col_double_precision = 7.89012, col_decimal = 890,
      col_decimal_p = 90, col_decimal_ps = 1.23, col_decimal_max = 99999
  WHERE col_int = 1;
SELECT * FROM fdw_test_type_num;
 col_int | col_bigint | col_real | col_float | col_double | col_double_precision | col_decimal | col_decimal_p | col_decimal_ps | col_decimal_max 
---------+------------+----------+-----------+------------+----------------------+-------------+---------------+----------------+-----------------
       2 |          3 |    4.567 |     5.678 |    6.78901 |              7.89012 |         890 |            90 |           1.23 |           99999
(1 row)

DELETE FROM fdw_test_type_num WHERE col_double = 6.78901;
SELECT * FROM fdw_test_type_num;
 col_int | col_bigint | col_real | col_float | col_double | col_double_precision | col_decimal | col_decimal_p | col_decimal_ps | col_decimal_max 
---------+------------+----------+-----------+------------+----------------------+-------------+---------------+----------------+-----------------
(0 rows)

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_test_type_num', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 3-2-1_4
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_type_str (
    col_char CHAR,
    col_char_l CHAR(64),
    col_character CHARACTER,
    col_character_l CHARACTER(64),
    col_varchar VARCHAR,
    col_varchar_l VARCHAR(64),
    col_char_varying CHAR VARYING,
    col_char_varying_l CHAR VARYING(64),
    col_character_varying CHARACTER VARYING,
    col_character_varying_l CHARACTER VARYING(64)
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_type_str
         List of foreign tables
 Schema |       Table       |  Server   
--------+-------------------+-----------
 public | fdw_test_type_str | tsurugidb
(1 row)

\d fdw_test_type_str
                   Foreign table "public.fdw_test_type_str"
         Column          | Type | Collation | Nullable | Default | FDW options 
-------------------------+------+-----------+----------+---------+-------------
 col_char                | text |           |          |         | 
 col_char_l              | text |           |          |         | 
 col_character           | text |           |          |         | 
 col_character_l         | text |           |          |         | 
 col_varchar             | text |           |          |         | 
 col_varchar_l           | text |           |          |         | 
 col_char_varying        | text |           |          |         | 
 col_char_varying_l      | text |           |          |         | 
 col_character_varying   | text |           |          |         | 
 col_character_varying_l | text |           |          |         | 
Server: tsurugidb

INSERT INTO fdw_test_type_str
  (col_char, col_char_l, col_character, col_character_l, col_varchar,
   col_varchar_l, col_char_varying, col_char_varying_l,
   col_character_varying, col_character_varying_l)
  VALUES
    ('1', 'char', '2', 'character', 'varchar', 'varchar_l', 'char_varying',
     'char_varying_l', 'character_varying', 'character_varying_l');
SELECT * FROM fdw_test_type_str;
 col_char |                            col_char_l                            | col_character |                         col_character_l                          | col_varchar | col_varchar_l | col_char_varying | col_char_varying_l | col_character_varying | col_character_varying_l 
----------+------------------------------------------------------------------+---------------+------------------------------------------------------------------+-------------+---------------+------------------+--------------------+-----------------------+-------------------------
 1        | char                                                             | 2             | character                                                        | varchar     | varchar_l     | char_varying     | char_varying_l     | character_varying     | character_varying_l
(1 row)

UPDATE fdw_test_type_str
  SET col_char = '3', col_char_l = 'char_upd', col_character = '4',
      col_character_l = 'character_upd', col_varchar = 'varchar_upd',
      col_varchar_l = 'varchar_l_upd', col_char_varying = 'char_varying_upd',
      col_char_varying_l = 'char_varying_l_upd',
      col_character_varying = 'character_varying_upd',
      col_character_varying_l = 'character_varying_l_upd'
  WHERE col_char = '1';
SELECT * FROM fdw_test_type_str;
 col_char |                            col_char_l                            | col_character |                         col_character_l                          | col_varchar | col_varchar_l | col_char_varying | col_char_varying_l | col_character_varying | col_character_varying_l 
----------+------------------------------------------------------------------+---------------+------------------------------------------------------------------+-------------+---------------+------------------+--------------------+-----------------------+-------------------------
 3        | char_upd                                                         | 4             | character_upd                                                    | varchar_upd | varchar_l_upd | char_varying_upd | char_varying_l_upd | character_varying_upd | character_varying_l_upd
(1 row)

DELETE FROM fdw_test_type_str WHERE col_char = '3';
SELECT * FROM fdw_test_type_str;
 col_char | col_char_l | col_character | col_character_l | col_varchar | col_varchar_l | col_char_varying | col_char_varying_l | col_character_varying | col_character_varying_l 
----------+------------+---------------+-----------------+-------------+---------------+------------------+--------------------+-----------------------+-------------------------
(0 rows)

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_test_type_str', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 3-3-1_4
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_type_datetime (
    col_date DATE,
    col_time TIME,
    col_time_tz TIME WITH TIME ZONE,
    col_timestamp TIMESTAMP,
    col_timestamp_tz TIMESTAMP WITH TIME ZONE
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_type_datetime
           List of foreign tables
 Schema |         Table          |  Server   
--------+------------------------+-----------
 public | fdw_test_type_datetime | tsurugidb
(1 row)

\d fdw_test_type_datetime
                         Foreign table "public.fdw_test_type_datetime"
      Column      |            Type             | Collation | Nullable | Default | FDW options 
------------------+-----------------------------+-----------+----------+---------+-------------
 col_date         | date                        |           |          |         | 
 col_time         | time without time zone      |           |          |         | 
 col_time_tz      | time with time zone         |           |          |         | 
 col_timestamp    | timestamp without time zone |           |          |         | 
 col_timestamp_tz | timestamp with time zone    |           |          |         | 
Server: tsurugidb

INSERT INTO fdw_test_type_datetime
  (col_date, col_time, col_timestamp, col_timestamp_tz)
  VALUES (DATE '2025-01-23', TIME '08:09:10', TIMESTAMP '2025-01-23 08:09:10',
          TIMESTAMP WITH TIME ZONE '2025-01-23 08:09:10+09');
SELECT * FROM fdw_test_type_datetime;
  col_date  | col_time | col_time_tz |    col_timestamp    |    col_timestamp_tz    
------------+----------+-------------+---------------------+------------------------
 2025-01-23 | 08:09:10 |             | 2025-01-23 08:09:10 | 2025-01-23 08:09:10+09
(1 row)

UPDATE fdw_test_type_datetime
  SET col_date = DATE '2025-02-12', col_time = TIME '09:10:11',
      col_timestamp = TIMESTAMP '2025-02-12 09:10:11',
      col_timestamp_tz = TIMESTAMP WITH TIME ZONE '2025-02-12 09:10:11+09'
  WHERE col_date = DATE '2025-01-23';
SELECT * FROM fdw_test_type_datetime;
  col_date  | col_time | col_time_tz |    col_timestamp    |    col_timestamp_tz    
------------+----------+-------------+---------------------+------------------------
 2025-02-12 | 09:10:11 |             | 2025-02-12 09:10:11 | 2025-02-12 09:10:11+09
(1 row)

DELETE FROM fdw_test_type_datetime WHERE col_date = DATE '2025-02-12';
SELECT * FROM fdw_test_type_datetime;
 col_date | col_time | col_time_tz | col_timestamp | col_timestamp_tz 
----------+----------+-------------+---------------+------------------
(0 rows)

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_test_type_datetime', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 3-4-1_4
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_type_binary (
    col_binary BINARY(11),
    col_varbinary VARBINARY,
    col_binary_var BINARY VARYING
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_type_binary
          List of foreign tables
 Schema |        Table         |  Server   
--------+----------------------+-----------
 public | fdw_test_type_binary | tsurugidb
(1 row)

\d fdw_test_type_binary;
              Foreign table "public.fdw_test_type_binary"
     Column     | Type  | Collation | Nullable | Default | FDW options 
----------------+-------+-----------+----------+---------+-------------
 col_binary     | bytea |           |          |         | 
 col_varbinary  | bytea |           |          |         | 
 col_binary_var | bytea |           |          |         | 
Server: tsurugidb

INSERT INTO fdw_test_type_binary (col_binary, col_varbinary, col_binary_var)
  VALUES (
    '\x3031323334353637383900',
    '\x4142434445464748495000',
    '\x6162636465666768697000'
  );
SELECT * FROM fdw_test_type_binary
  WHERE col_binary = '\x3031323334353637383900';
        col_binary        |      col_varbinary       |      col_binary_var      
--------------------------+--------------------------+--------------------------
 \x3031323334353637383900 | \x4142434445464748495000 | \x6162636465666768697000
(1 row)

UPDATE fdw_test_type_binary
  SET col_binary = '\x6162636465666768697000',
      col_varbinary = '\x3031323334353637383900',
      col_binary_var = '\x4142434445464748495000'
  WHERE col_varbinary = '\x4142434445464748495000';
SELECT * FROM fdw_test_type_binary
  WHERE col_binary_var = '\x4142434445464748495000';
        col_binary        |      col_varbinary       |      col_binary_var      
--------------------------+--------------------------+--------------------------
 \x6162636465666768697000 | \x3031323334353637383900 | \x4142434445464748495000
(1 row)

DELETE FROM fdw_test_type_binary
  WHERE col_binary = '\x6162636465666768697000';
SELECT * FROM fdw_test_type_binary;
 col_binary | col_varbinary | col_binary_var 
------------+---------------+----------------
(0 rows)

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_test_type_binary', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 4-1-1
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_table_name2_________3_________4_________5_________6__
    (id INT, name VARCHAR)
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_table_name2_________3_________4_________5_________6__
                               List of foreign tables
 Schema |                             Table                              |  Server   
--------+----------------------------------------------------------------+-----------
 public | fdw_test_table_name2_________3_________4_________5_________6__ | tsurugidb
(1 row)

\d fdw_test_table_name2_________3_________4_________5_________6__
Foreign table "public.fdw_test_table_name2_________3_________4_________5_________6__"
 Column |  Type   | Collation | Nullable | Default | FDW options 
--------+---------+-----------+----------+---------+-------------
 id     | integer |           |          |         | 
 name   | text    |           |          |         | 
Server: tsurugidb

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('
  DROP TABLE fdw_test_table_name2_________3_________4_________5_________6__
', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 4-1-2
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_table_name2_________3_________4_________5_________6___
    (id INT, name VARCHAR)
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_table_name2_________3_________4_________5_________6___
                                List of foreign tables
 Schema |                              Table                              |  Server   
--------+-----------------------------------------------------------------+-----------
 public | fdw_test_table_name2_________3_________4_________5_________6___ | tsurugidb
(1 row)

\d fdw_test_table_name2_________3_________4_________5_________6___
Foreign table "public.fdw_test_table_name2_________3_________4_________5_________6___"
 Column |  Type   | Collation | Nullable | Default | FDW options 
--------+---------+-----------+----------+---------+-------------
 id     | integer |           |          |         | 
 name   | text    |           |          |         | 
Server: tsurugidb

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('
  DROP TABLE fdw_test_table_name2_________3_________4_________5_________6___
', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 4-1-3
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_table_name2_________3_________4_________5_________6____
    (id INT, name VARCHAR)
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
NOTICE:  identifier "fdw_test_table_name2_________3_________4_________5_________6____" will be truncated to "fdw_test_table_name2_________3_________4_________5_________6___"
\det fdw_test_table_name2_________3_________4_________5_________6___
                                List of foreign tables
 Schema |                              Table                              |  Server   
--------+-----------------------------------------------------------------+-----------
 public | fdw_test_table_name2_________3_________4_________5_________6___ | tsurugidb
(1 row)

\d fdw_test_table_name2_________3_________4_________5_________6___
Foreign table "public.fdw_test_table_name2_________3_________4_________5_________6___"
 Column |  Type   | Collation | Nullable | Default | FDW options 
--------+---------+-----------+----------+---------+-------------
 id     | integer |           |          |         | 
 name   | text    |           |          |         | 
Server: tsurugidb

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('
  DROP TABLE fdw_test_table_name2_________3_________4_________5_________6____
', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 4-2-1
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_table (
    id INT,
    columnname_________2_________3_________4_________5_________6__ VARCHAR
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_table
       List of foreign tables
 Schema |     Table      |  Server   
--------+----------------+-----------
 public | fdw_test_table | tsurugidb
(1 row)

\d fdw_test_table
                                          Foreign table "public.fdw_test_table"
                             Column                             |  Type   | Collation | Nullable | Default | FDW options 
----------------------------------------------------------------+---------+-----------+----------+---------+-------------
 id                                                             | integer |           |          |         | 
 columnname_________2_________3_________4_________5_________6__ | text    |           |          |         | 
Server: tsurugidb

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_test_table', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 4-2-2
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_table (
    id INT,
    columnname_________2_________3_________4_________5_________6___ VARCHAR
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_table
       List of foreign tables
 Schema |     Table      |  Server   
--------+----------------+-----------
 public | fdw_test_table | tsurugidb
(1 row)

\d fdw_test_table
                                          Foreign table "public.fdw_test_table"
                             Column                              |  Type   | Collation | Nullable | Default | FDW options 
-----------------------------------------------------------------+---------+-----------+----------+---------+-------------
 id                                                              | integer |           |          |         | 
 columnname_________2_________3_________4_________5_________6___ | text    |           |          |         | 
Server: tsurugidb

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_test_table', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 4-2-3
--- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_test_table (
    id INT,
    columnname_________2_________3_________4_________5_________6____ VARCHAR
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
NOTICE:  identifier "columnname_________2_________3_________4_________5_________6____" will be truncated to "columnname_________2_________3_________4_________5_________6___"
\det fdw_test_table
       List of foreign tables
 Schema |     Table      |  Server   
--------+----------------+-----------
 public | fdw_test_table | tsurugidb
(1 row)

\d fdw_test_table
                                          Foreign table "public.fdw_test_table"
                             Column                              |  Type   | Collation | Nullable | Default | FDW options 
-----------------------------------------------------------------+---------+-----------+----------+---------+-------------
 id                                                              | integer |           |          |         | 
 columnname_________2_________3_________4_________5_________6___ | text    |           |          |         | 
Server: tsurugidb

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_test_table', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

-- Test case: 6-1
--- Test setup: DDL of the Tsurugi
DO $$
DECLARE
  TABLE_MAX CONSTANT INT := 100;
  COLUMN_MAX CONSTANT INT := 50;
  columns_def TEXT;
  i INT;
BEGIN
  SELECT string_agg(format('col_%s INT', n), ', ')
    INTO columns_def
  FROM generate_series(1, COLUMN_MAX) n;

  FOR i IN 1..TABLE_MAX LOOP
    EXECUTE format(
      'SELECT tg_execute_ddl(''CREATE TABLE IF NOT EXISTS fdw_test_table_%s (%s)'', ''tsurugidb'')',
      to_char(i, 'FM0000'), columns_def);
  END LOOP;
END $$;
--- Test
IMPORT FOREIGN SCHEMA public FROM SERVER tsurugidb INTO public;
\det fdw_test_table_*
          List of foreign tables
 Schema |        Table        |  Server   
--------+---------------------+-----------
 public | fdw_test_table_0001 | tsurugidb
 public | fdw_test_table_0002 | tsurugidb
 public | fdw_test_table_0003 | tsurugidb
 public | fdw_test_table_0004 | tsurugidb
 public | fdw_test_table_0005 | tsurugidb
 public | fdw_test_table_0006 | tsurugidb
 public | fdw_test_table_0007 | tsurugidb
 public | fdw_test_table_0008 | tsurugidb
 public | fdw_test_table_0009 | tsurugidb
 public | fdw_test_table_0010 | tsurugidb
 public | fdw_test_table_0011 | tsurugidb
 public | fdw_test_table_0012 | tsurugidb
 public | fdw_test_table_0013 | tsurugidb
 public | fdw_test_table_0014 | tsurugidb
 public | fdw_test_table_0015 | tsurugidb
 public | fdw_test_table_0016 | tsurugidb
 public | fdw_test_table_0017 | tsurugidb
 public | fdw_test_table_0018 | tsurugidb
 public | fdw_test_table_0019 | tsurugidb
 public | fdw_test_table_0020 | tsurugidb
 public | fdw_test_table_0021 | tsurugidb
 public | fdw_test_table_0022 | tsurugidb
 public | fdw_test_table_0023 | tsurugidb
 public | fdw_test_table_0024 | tsurugidb
 public | fdw_test_table_0025 | tsurugidb
 public | fdw_test_table_0026 | tsurugidb
 public | fdw_test_table_0027 | tsurugidb
 public | fdw_test_table_0028 | tsurugidb
 public | fdw_test_table_0029 | tsurugidb
 public | fdw_test_table_0030 | tsurugidb
 public | fdw_test_table_0031 | tsurugidb
 public | fdw_test_table_0032 | tsurugidb
 public | fdw_test_table_0033 | tsurugidb
 public | fdw_test_table_0034 | tsurugidb
 public | fdw_test_table_0035 | tsurugidb
 public | fdw_test_table_0036 | tsurugidb
 public | fdw_test_table_0037 | tsurugidb
 public | fdw_test_table_0038 | tsurugidb
 public | fdw_test_table_0039 | tsurugidb
 public | fdw_test_table_0040 | tsurugidb
 public | fdw_test_table_0041 | tsurugidb
 public | fdw_test_table_0042 | tsurugidb
 public | fdw_test_table_0043 | tsurugidb
 public | fdw_test_table_0044 | tsurugidb
 public | fdw_test_table_0045 | tsurugidb
 public | fdw_test_table_0046 | tsurugidb
 public | fdw_test_table_0047 | tsurugidb
 public | fdw_test_table_0048 | tsurugidb
 public | fdw_test_table_0049 | tsurugidb
 public | fdw_test_table_0050 | tsurugidb
 public | fdw_test_table_0051 | tsurugidb
 public | fdw_test_table_0052 | tsurugidb
 public | fdw_test_table_0053 | tsurugidb
 public | fdw_test_table_0054 | tsurugidb
 public | fdw_test_table_0055 | tsurugidb
 public | fdw_test_table_0056 | tsurugidb
 public | fdw_test_table_0057 | tsurugidb
 public | fdw_test_table_0058 | tsurugidb
 public | fdw_test_table_0059 | tsurugidb
 public | fdw_test_table_0060 | tsurugidb
 public | fdw_test_table_0061 | tsurugidb
 public | fdw_test_table_0062 | tsurugidb
 public | fdw_test_table_0063 | tsurugidb
 public | fdw_test_table_0064 | tsurugidb
 public | fdw_test_table_0065 | tsurugidb
 public | fdw_test_table_0066 | tsurugidb
 public | fdw_test_table_0067 | tsurugidb
 public | fdw_test_table_0068 | tsurugidb
 public | fdw_test_table_0069 | tsurugidb
 public | fdw_test_table_0070 | tsurugidb
 public | fdw_test_table_0071 | tsurugidb
 public | fdw_test_table_0072 | tsurugidb
 public | fdw_test_table_0073 | tsurugidb
 public | fdw_test_table_0074 | tsurugidb
 public | fdw_test_table_0075 | tsurugidb
 public | fdw_test_table_0076 | tsurugidb
 public | fdw_test_table_0077 | tsurugidb
 public | fdw_test_table_0078 | tsurugidb
 public | fdw_test_table_0079 | tsurugidb
 public | fdw_test_table_0080 | tsurugidb
 public | fdw_test_table_0081 | tsurugidb
 public | fdw_test_table_0082 | tsurugidb
 public | fdw_test_table_0083 | tsurugidb
 public | fdw_test_table_0084 | tsurugidb
 public | fdw_test_table_0085 | tsurugidb
 public | fdw_test_table_0086 | tsurugidb
 public | fdw_test_table_0087 | tsurugidb
 public | fdw_test_table_0088 | tsurugidb
 public | fdw_test_table_0089 | tsurugidb
 public | fdw_test_table_0090 | tsurugidb
 public | fdw_test_table_0091 | tsurugidb
 public | fdw_test_table_0092 | tsurugidb
 public | fdw_test_table_0093 | tsurugidb
 public | fdw_test_table_0094 | tsurugidb
 public | fdw_test_table_0095 | tsurugidb
 public | fdw_test_table_0096 | tsurugidb
 public | fdw_test_table_0097 | tsurugidb
 public | fdw_test_table_0098 | tsurugidb
 public | fdw_test_table_0099 | tsurugidb
 public | fdw_test_table_0100 | tsurugidb
(100 rows)

\d fdw_test_table_0001
           Foreign table "public.fdw_test_table_0001"
 Column |  Type   | Collation | Nullable | Default | FDW options 
--------+---------+-----------+----------+---------+-------------
 col_1  | integer |           |          |         | 
 col_2  | integer |           |          |         | 
 col_3  | integer |           |          |         | 
 col_4  | integer |           |          |         | 
 col_5  | integer |           |          |         | 
 col_6  | integer |           |          |         | 
 col_7  | integer |           |          |         | 
 col_8  | integer |           |          |         | 
 col_9  | integer |           |          |         | 
 col_10 | integer |           |          |         | 
 col_11 | integer |           |          |         | 
 col_12 | integer |           |          |         | 
 col_13 | integer |           |          |         | 
 col_14 | integer |           |          |         | 
 col_15 | integer |           |          |         | 
 col_16 | integer |           |          |         | 
 col_17 | integer |           |          |         | 
 col_18 | integer |           |          |         | 
 col_19 | integer |           |          |         | 
 col_20 | integer |           |          |         | 
 col_21 | integer |           |          |         | 
 col_22 | integer |           |          |         | 
 col_23 | integer |           |          |         | 
 col_24 | integer |           |          |         | 
 col_25 | integer |           |          |         | 
 col_26 | integer |           |          |         | 
 col_27 | integer |           |          |         | 
 col_28 | integer |           |          |         | 
 col_29 | integer |           |          |         | 
 col_30 | integer |           |          |         | 
 col_31 | integer |           |          |         | 
 col_32 | integer |           |          |         | 
 col_33 | integer |           |          |         | 
 col_34 | integer |           |          |         | 
 col_35 | integer |           |          |         | 
 col_36 | integer |           |          |         | 
 col_37 | integer |           |          |         | 
 col_38 | integer |           |          |         | 
 col_39 | integer |           |          |         | 
 col_40 | integer |           |          |         | 
 col_41 | integer |           |          |         | 
 col_42 | integer |           |          |         | 
 col_43 | integer |           |          |         | 
 col_44 | integer |           |          |         | 
 col_45 | integer |           |          |         | 
 col_46 | integer |           |          |         | 
 col_47 | integer |           |          |         | 
 col_48 | integer |           |          |         | 
 col_49 | integer |           |          |         | 
 col_50 | integer |           |          |         | 
Server: tsurugidb

\d fdw_test_table_0010
           Foreign table "public.fdw_test_table_0010"
 Column |  Type   | Collation | Nullable | Default | FDW options 
--------+---------+-----------+----------+---------+-------------
 col_1  | integer |           |          |         | 
 col_2  | integer |           |          |         | 
 col_3  | integer |           |          |         | 
 col_4  | integer |           |          |         | 
 col_5  | integer |           |          |         | 
 col_6  | integer |           |          |         | 
 col_7  | integer |           |          |         | 
 col_8  | integer |           |          |         | 
 col_9  | integer |           |          |         | 
 col_10 | integer |           |          |         | 
 col_11 | integer |           |          |         | 
 col_12 | integer |           |          |         | 
 col_13 | integer |           |          |         | 
 col_14 | integer |           |          |         | 
 col_15 | integer |           |          |         | 
 col_16 | integer |           |          |         | 
 col_17 | integer |           |          |         | 
 col_18 | integer |           |          |         | 
 col_19 | integer |           |          |         | 
 col_20 | integer |           |          |         | 
 col_21 | integer |           |          |         | 
 col_22 | integer |           |          |         | 
 col_23 | integer |           |          |         | 
 col_24 | integer |           |          |         | 
 col_25 | integer |           |          |         | 
 col_26 | integer |           |          |         | 
 col_27 | integer |           |          |         | 
 col_28 | integer |           |          |         | 
 col_29 | integer |           |          |         | 
 col_30 | integer |           |          |         | 
 col_31 | integer |           |          |         | 
 col_32 | integer |           |          |         | 
 col_33 | integer |           |          |         | 
 col_34 | integer |           |          |         | 
 col_35 | integer |           |          |         | 
 col_36 | integer |           |          |         | 
 col_37 | integer |           |          |         | 
 col_38 | integer |           |          |         | 
 col_39 | integer |           |          |         | 
 col_40 | integer |           |          |         | 
 col_41 | integer |           |          |         | 
 col_42 | integer |           |          |         | 
 col_43 | integer |           |          |         | 
 col_44 | integer |           |          |         | 
 col_45 | integer |           |          |         | 
 col_46 | integer |           |          |         | 
 col_47 | integer |           |          |         | 
 col_48 | integer |           |          |         | 
 col_49 | integer |           |          |         | 
 col_50 | integer |           |          |         | 
Server: tsurugidb

\d fdw_test_table_0050
           Foreign table "public.fdw_test_table_0050"
 Column |  Type   | Collation | Nullable | Default | FDW options 
--------+---------+-----------+----------+---------+-------------
 col_1  | integer |           |          |         | 
 col_2  | integer |           |          |         | 
 col_3  | integer |           |          |         | 
 col_4  | integer |           |          |         | 
 col_5  | integer |           |          |         | 
 col_6  | integer |           |          |         | 
 col_7  | integer |           |          |         | 
 col_8  | integer |           |          |         | 
 col_9  | integer |           |          |         | 
 col_10 | integer |           |          |         | 
 col_11 | integer |           |          |         | 
 col_12 | integer |           |          |         | 
 col_13 | integer |           |          |         | 
 col_14 | integer |           |          |         | 
 col_15 | integer |           |          |         | 
 col_16 | integer |           |          |         | 
 col_17 | integer |           |          |         | 
 col_18 | integer |           |          |         | 
 col_19 | integer |           |          |         | 
 col_20 | integer |           |          |         | 
 col_21 | integer |           |          |         | 
 col_22 | integer |           |          |         | 
 col_23 | integer |           |          |         | 
 col_24 | integer |           |          |         | 
 col_25 | integer |           |          |         | 
 col_26 | integer |           |          |         | 
 col_27 | integer |           |          |         | 
 col_28 | integer |           |          |         | 
 col_29 | integer |           |          |         | 
 col_30 | integer |           |          |         | 
 col_31 | integer |           |          |         | 
 col_32 | integer |           |          |         | 
 col_33 | integer |           |          |         | 
 col_34 | integer |           |          |         | 
 col_35 | integer |           |          |         | 
 col_36 | integer |           |          |         | 
 col_37 | integer |           |          |         | 
 col_38 | integer |           |          |         | 
 col_39 | integer |           |          |         | 
 col_40 | integer |           |          |         | 
 col_41 | integer |           |          |         | 
 col_42 | integer |           |          |         | 
 col_43 | integer |           |          |         | 
 col_44 | integer |           |          |         | 
 col_45 | integer |           |          |         | 
 col_46 | integer |           |          |         | 
 col_47 | integer |           |          |         | 
 col_48 | integer |           |          |         | 
 col_49 | integer |           |          |         | 
 col_50 | integer |           |          |         | 
Server: tsurugidb

\d fdw_test_table_0099
           Foreign table "public.fdw_test_table_0099"
 Column |  Type   | Collation | Nullable | Default | FDW options 
--------+---------+-----------+----------+---------+-------------
 col_1  | integer |           |          |         | 
 col_2  | integer |           |          |         | 
 col_3  | integer |           |          |         | 
 col_4  | integer |           |          |         | 
 col_5  | integer |           |          |         | 
 col_6  | integer |           |          |         | 
 col_7  | integer |           |          |         | 
 col_8  | integer |           |          |         | 
 col_9  | integer |           |          |         | 
 col_10 | integer |           |          |         | 
 col_11 | integer |           |          |         | 
 col_12 | integer |           |          |         | 
 col_13 | integer |           |          |         | 
 col_14 | integer |           |          |         | 
 col_15 | integer |           |          |         | 
 col_16 | integer |           |          |         | 
 col_17 | integer |           |          |         | 
 col_18 | integer |           |          |         | 
 col_19 | integer |           |          |         | 
 col_20 | integer |           |          |         | 
 col_21 | integer |           |          |         | 
 col_22 | integer |           |          |         | 
 col_23 | integer |           |          |         | 
 col_24 | integer |           |          |         | 
 col_25 | integer |           |          |         | 
 col_26 | integer |           |          |         | 
 col_27 | integer |           |          |         | 
 col_28 | integer |           |          |         | 
 col_29 | integer |           |          |         | 
 col_30 | integer |           |          |         | 
 col_31 | integer |           |          |         | 
 col_32 | integer |           |          |         | 
 col_33 | integer |           |          |         | 
 col_34 | integer |           |          |         | 
 col_35 | integer |           |          |         | 
 col_36 | integer |           |          |         | 
 col_37 | integer |           |          |         | 
 col_38 | integer |           |          |         | 
 col_39 | integer |           |          |         | 
 col_40 | integer |           |          |         | 
 col_41 | integer |           |          |         | 
 col_42 | integer |           |          |         | 
 col_43 | integer |           |          |         | 
 col_44 | integer |           |          |         | 
 col_45 | integer |           |          |         | 
 col_46 | integer |           |          |         | 
 col_47 | integer |           |          |         | 
 col_48 | integer |           |          |         | 
 col_49 | integer |           |          |         | 
 col_50 | integer |           |          |         | 
Server: tsurugidb

\d fdw_test_table_0100
           Foreign table "public.fdw_test_table_0100"
 Column |  Type   | Collation | Nullable | Default | FDW options 
--------+---------+-----------+----------+---------+-------------
 col_1  | integer |           |          |         | 
 col_2  | integer |           |          |         | 
 col_3  | integer |           |          |         | 
 col_4  | integer |           |          |         | 
 col_5  | integer |           |          |         | 
 col_6  | integer |           |          |         | 
 col_7  | integer |           |          |         | 
 col_8  | integer |           |          |         | 
 col_9  | integer |           |          |         | 
 col_10 | integer |           |          |         | 
 col_11 | integer |           |          |         | 
 col_12 | integer |           |          |         | 
 col_13 | integer |           |          |         | 
 col_14 | integer |           |          |         | 
 col_15 | integer |           |          |         | 
 col_16 | integer |           |          |         | 
 col_17 | integer |           |          |         | 
 col_18 | integer |           |          |         | 
 col_19 | integer |           |          |         | 
 col_20 | integer |           |          |         | 
 col_21 | integer |           |          |         | 
 col_22 | integer |           |          |         | 
 col_23 | integer |           |          |         | 
 col_24 | integer |           |          |         | 
 col_25 | integer |           |          |         | 
 col_26 | integer |           |          |         | 
 col_27 | integer |           |          |         | 
 col_28 | integer |           |          |         | 
 col_29 | integer |           |          |         | 
 col_30 | integer |           |          |         | 
 col_31 | integer |           |          |         | 
 col_32 | integer |           |          |         | 
 col_33 | integer |           |          |         | 
 col_34 | integer |           |          |         | 
 col_35 | integer |           |          |         | 
 col_36 | integer |           |          |         | 
 col_37 | integer |           |          |         | 
 col_38 | integer |           |          |         | 
 col_39 | integer |           |          |         | 
 col_40 | integer |           |          |         | 
 col_41 | integer |           |          |         | 
 col_42 | integer |           |          |         | 
 col_43 | integer |           |          |         | 
 col_44 | integer |           |          |         | 
 col_45 | integer |           |          |         | 
 col_46 | integer |           |          |         | 
 col_47 | integer |           |          |         | 
 col_48 | integer |           |          |         | 
 col_49 | integer |           |          |         | 
 col_50 | integer |           |          |         | 
Server: tsurugidb

--- Test teardown: DDL of the PostgreSQL
SELECT drop_foreign_tables();
 drop_foreign_tables 
---------------------
 DROP FOREIGN TABLE
(1 row)

--- Test teardown: DDL of the Tsurugi
DO $$
DECLARE
  TABLE_MAX CONSTANT INT := 100;
  i INT;
BEGIN
  FOR i IN 1..TABLE_MAX LOOP
    EXECUTE format(
      'SELECT tg_execute_ddl(''DROP TABLE IF EXISTS fdw_test_table_%s'', ''tsurugidb'')',
      to_char(i, 'FM0000'));
  END LOOP;
END $$;
