/* Test case: SELECT statement variations */
-- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_select_variation_table_1 (
    id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    value NUMERIC(10,2) NOT NULL,
    ref_id INT,
    manager_id INT
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

SELECT tg_execute_ddl('
  CREATE TABLE fdw_select_variation_table_2 (
    id INT PRIMARY KEY,
    name VARCHAR(100) NOT NULL
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

-- Test setup: DDL of the PostgreSQL
CREATE FOREIGN TABLE fdw_select_variation_table_1 (
  id INT,
  name TEXT,
  value NUMERIC,
  ref_id INT,
  manager_id INT
) SERVER tsurugidb;
CREATE FOREIGN TABLE fdw_select_variation_table_2 (
  id INT,
  name TEXT
) SERVER tsurugidb;
-- Initialization of test data
INSERT INTO fdw_select_variation_table_1
  (id, name, value, ref_id, manager_id) VALUES
  (1000, 'name-1000', 100000, NULL, NULL),
  (1001, 'name-1001', 60000, 1, 1002),
  (1002, 'name-1002', 75000, 1, 1000),
  (1003, 'name-1003', 50000, 2, 1005),
  (1004, 'name-1004', 55000, 3, 1005),
  (1005, 'name-1005', 80000, 3, 1000);
INSERT INTO fdw_select_variation_table_2
  (id, name) VALUES
  (1, 'dep-1'),
  (2, 'dep-2'),
  (3, 'dep-3'),
  (4, 'dep-4');
-- Test
--- WITH
WITH value_data AS (
  SELECT id, name, value FROM fdw_select_variation_table_1 WHERE value >= 75000
)
SELECT * FROM value_data;
  id  |   name    |   value   
------+-----------+-----------
 1000 | name-1000 | 100000.00
 1002 | name-1002 |  75000.00
 1005 | name-1005 |  80000.00
(3 rows)

--- WITH RECURSIVE
WITH RECURSIVE chart AS (
  SELECT id, name, manager_id, 1 AS level
    FROM fdw_select_variation_table_1
    WHERE manager_id IS NULL
  UNION ALL
  SELECT e.id, e.name, e.manager_id, oc.level + 1
    FROM fdw_select_variation_table_1 e
    JOIN chart oc ON e.manager_id = oc.id
)
SELECT * FROM chart ORDER BY level, id;
  id  |   name    | manager_id | level 
------+-----------+------------+-------
 1000 | name-1000 |            |     1
 1002 | name-1002 |       1000 |     2
 1005 | name-1005 |       1000 |     2
 1001 | name-1001 |       1002 |     3
 1003 | name-1003 |       1005 |     3
 1004 | name-1004 |       1005 |     3
(6 rows)

--- SELECT ALL
SELECT ALL id, name, value FROM fdw_select_variation_table_1 ORDER BY value, id;
  id  |   name    |   value   
------+-----------+-----------
 1003 | name-1003 |  50000.00
 1004 | name-1004 |  55000.00
 1001 | name-1001 |  60000.00
 1002 | name-1002 |  75000.00
 1005 | name-1005 |  80000.00
 1000 | name-1000 | 100000.00
(6 rows)

--- SELECT DISTINCT
SELECT DISTINCT ON (id) id, name FROM fdw_select_variation_table_1 ORDER BY id;
 id | name  
----+-------
  1 | dep-1
  2 | dep-2
  3 | dep-3
(3 rows)

SELECT DISTINCT ON (t2.id) t2.id, t2.name
  FROM fdw_select_variation_table_1 t1
  JOIN fdw_select_variation_table_2 t2 ON (t1.ref_id = t2.id)
  ORDER BY t2.id;
 id | name  
----+-------
  1 | dep-1
  2 | dep-2
  3 | dep-3
(3 rows)

--- AS
SELECT id AS user_id, name AS user_name FROM fdw_select_variation_table_1;
 user_id | user_name 
---------+-----------
    1000 | name-1000
    1001 | name-1001
    1002 | name-1002
    1003 | name-1003
    1004 | name-1004
    1005 | name-1005
(6 rows)

--- Arithmetic operation
SELECT id, name, ((value / 10000) * ref_id)::int AS lank FROM fdw_select_variation_table_1;
  id  |   name    | lank 
------+-----------+------
 1000 | name-1000 |     
 1001 | name-1001 |    6
 1002 | name-1002 |    8
 1003 | name-1003 |   10
 1004 | name-1004 |   17
 1005 | name-1005 |   24
(6 rows)

--- CASE WHEN
SELECT id, name, CASE WHEN value >= 100000 THEN 'High' WHEN value >= 75000 THEN 'Medium' ELSE 'Low' END AS lank
  FROM fdw_select_variation_table_1;
  id  |   name    |  lank  
------+-----------+--------
 1000 | name-1000 | High
 1001 | name-1001 | Low
 1002 | name-1002 | Medium
 1003 | name-1003 | Low
 1004 | name-1004 | Low
 1005 | name-1005 | Medium
(6 rows)

--- Sub queries
SELECT * FROM fdw_select_variation_table_1 WHERE value = (SELECT MAX(value) FROM fdw_select_variation_table_1);
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the query on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYMBOL_ANALYZE_EXCEPTION (SQL-03004: compile failed with error:variable_not_found message:"placeholder is not found: :param1" location:<input>:1:94+7)
CONTEXT:  SQL query: SELECT id, name, value, ref_id, manager_id FROM fdw_select_variation_table_1 WHERE ((value = :param1))
--- [INNER] JOIN
SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  JOIN fdw_select_variation_table_2 t2 ON t1.ref_id = t2.id
  ORDER BY t1.id;
  id  |   name    | name  
------+-----------+-------
 1001 | name-1001 | dep-1
 1002 | name-1002 | dep-1
 1003 | name-1003 | dep-2
 1004 | name-1004 | dep-3
 1005 | name-1005 | dep-3
(5 rows)

SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  INNER JOIN fdw_select_variation_table_2 t2 ON t1.ref_id = t2.id
  ORDER BY t1.id;
  id  |   name    | name  
------+-----------+-------
 1001 | name-1001 | dep-1
 1002 | name-1002 | dep-1
 1003 | name-1003 | dep-2
 1004 | name-1004 | dep-3
 1005 | name-1005 | dep-3
(5 rows)

--- LEFT [OUTER] JOIN
SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  LEFT OUTER JOIN fdw_select_variation_table_2 t2 ON t1.ref_id = t2.id ORDER BY t1.id;
  id  |   name    | name  
------+-----------+-------
 1000 | name-1000 | 
 1001 | name-1001 | dep-1
 1002 | name-1002 | dep-1
 1003 | name-1003 | dep-2
 1004 | name-1004 | dep-3
 1005 | name-1005 | dep-3
(6 rows)

SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  LEFT JOIN fdw_select_variation_table_2 t2 ON t1.ref_id = t2.id ORDER BY t1.id;
  id  |   name    | name  
------+-----------+-------
 1000 | name-1000 | 
 1001 | name-1001 | dep-1
 1002 | name-1002 | dep-1
 1003 | name-1003 | dep-2
 1004 | name-1004 | dep-3
 1005 | name-1005 | dep-3
(6 rows)

--- RIGHT [OUTER] JOIN
SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  RIGHT OUTER JOIN fdw_select_variation_table_2 t2 ON t1.ref_id = t2.id ORDER BY t2.id;
  id  |   name    | name  
------+-----------+-------
 1001 | name-1001 | dep-1
 1002 | name-1002 | dep-1
 1003 | name-1003 | dep-2
 1004 | name-1004 | dep-3
 1005 | name-1005 | dep-3
      |           | dep-4
(6 rows)

SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  RIGHT JOIN fdw_select_variation_table_2 t2 ON t1.ref_id = t2.id ORDER BY t2.id;
  id  |   name    | name  
------+-----------+-------
 1001 | name-1001 | dep-1
 1002 | name-1002 | dep-1
 1003 | name-1003 | dep-2
 1004 | name-1004 | dep-3
 1005 | name-1005 | dep-3
      |           | dep-4
(6 rows)

--- FULL [OUTER] JOIN
SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  FULL OUTER JOIN fdw_select_variation_table_2 t2 ON t1.ref_id = t2.id ORDER BY t1.id, t2.id;
  id  |   name    | name  
------+-----------+-------
      |           | dep-4
 1000 | name-1000 | 
 1001 | name-1001 | dep-1
 1002 | name-1002 | dep-1
 1003 | name-1003 | dep-2
 1004 | name-1004 | dep-3
 1005 | name-1005 | dep-3
(7 rows)

SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  FULL JOIN fdw_select_variation_table_2 t2 ON t1.ref_id = t2.id ORDER BY t1.id, t2.id;
  id  |   name    | name  
------+-----------+-------
      |           | dep-4
 1000 | name-1000 | 
 1001 | name-1001 | dep-1
 1002 | name-1002 | dep-1
 1003 | name-1003 | dep-2
 1004 | name-1004 | dep-3
 1005 | name-1005 | dep-3
(7 rows)

--- CROSS JOIN
SELECT t1.id, t1.name, t2.name
  FROM fdw_select_variation_table_1 t1
  CROSS JOIN fdw_select_variation_table_2 t2;
  id  |   name    | name  
------+-----------+-------
 1000 | name-1000 | dep-1
 1000 | name-1000 | dep-2
 1000 | name-1000 | dep-3
 1000 | name-1000 | dep-4
 1001 | name-1001 | dep-1
 1001 | name-1001 | dep-2
 1001 | name-1001 | dep-3
 1001 | name-1001 | dep-4
 1002 | name-1002 | dep-1
 1002 | name-1002 | dep-2
 1002 | name-1002 | dep-3
 1002 | name-1002 | dep-4
 1003 | name-1003 | dep-1
 1003 | name-1003 | dep-2
 1003 | name-1003 | dep-3
 1003 | name-1003 | dep-4
 1004 | name-1004 | dep-1
 1004 | name-1004 | dep-2
 1004 | name-1004 | dep-3
 1004 | name-1004 | dep-4
 1005 | name-1005 | dep-1
 1005 | name-1005 | dep-2
 1005 | name-1005 | dep-3
 1005 | name-1005 | dep-4
(24 rows)

--- BETWEEN ... AND
SELECT id, name, value FROM fdw_select_variation_table_1 WHERE value BETWEEN 60000 AND 80000;
  id  |   name    |  value   
------+-----------+----------
 1001 | name-1001 | 60000.00
 1002 | name-1002 | 75000.00
 1005 | name-1005 | 80000.00
(3 rows)

--- IN
SELECT id, name, manager_id FROM fdw_select_variation_table_1 WHERE manager_id IN (1000);
  id  |   name    | manager_id 
------+-----------+------------
 1002 | name-1002 |       1000
 1005 | name-1005 |       1000
(2 rows)

SELECT id, name, manager_id FROM fdw_select_variation_table_1 WHERE manager_id IN (1000, 1005);
  id  |   name    | manager_id 
------+-----------+------------
 1002 | name-1002 |       1000
 1003 | name-1003 |       1005
 1004 | name-1004 |       1005
 1005 | name-1005 |       1000
(4 rows)

--- LIKE
SELECT id, name, value FROM fdw_select_variation_table_1 WHERE name LIKE 'name-%';
  id  |   name    |   value   
------+-----------+-----------
 1000 | name-1000 | 100000.00
 1001 | name-1001 |  60000.00
 1002 | name-1002 |  75000.00
 1003 | name-1003 |  50000.00
 1004 | name-1004 |  55000.00
 1005 | name-1005 |  80000.00
(6 rows)

--- ORDER BY
SELECT * FROM fdw_select_variation_table_1 ORDER BY value;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1003 | name-1003 |  50000.00 |      2 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1001 | name-1001 |  60000.00 |      1 |       1002
 1002 | name-1002 |  75000.00 |      1 |       1000
 1005 | name-1005 |  80000.00 |      3 |       1000
 1000 | name-1000 | 100000.00 |        |           
(6 rows)

--- ORDER BY ASC
SELECT * FROM fdw_select_variation_table_1 ORDER BY value ASC;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1003 | name-1003 |  50000.00 |      2 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1001 | name-1001 |  60000.00 |      1 |       1002
 1002 | name-1002 |  75000.00 |      1 |       1000
 1005 | name-1005 |  80000.00 |      3 |       1000
 1000 | name-1000 | 100000.00 |        |           
(6 rows)

--- ORDER BY DESC
SELECT * FROM fdw_select_variation_table_1 ORDER BY value DESC;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1005 | name-1005 |  80000.00 |      3 |       1000
 1002 | name-1002 |  75000.00 |      1 |       1000
 1001 | name-1001 |  60000.00 |      1 |       1002
 1004 | name-1004 |  55000.00 |      3 |       1005
 1003 | name-1003 |  50000.00 |      2 |       1005
(6 rows)

--- ORDER BY USING operator
SELECT * FROM fdw_select_variation_table_1 ORDER BY value USING >;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1005 | name-1005 |  80000.00 |      3 |       1000
 1002 | name-1002 |  75000.00 |      1 |       1000
 1001 | name-1001 |  60000.00 |      1 |       1002
 1004 | name-1004 |  55000.00 |      3 |       1005
 1003 | name-1003 |  50000.00 |      2 |       1005
(6 rows)

--- ORDER BY + NULLS FIRST
SELECT * FROM fdw_select_variation_table_1 ORDER BY ref_id NULLS FIRST;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1001 | name-1001 |  60000.00 |      1 |       1002
 1002 | name-1002 |  75000.00 |      1 |       1000
 1003 | name-1003 |  50000.00 |      2 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1005 | name-1005 |  80000.00 |      3 |       1000
(6 rows)

--- ORDER BY + NULLS LAST
SELECT * FROM fdw_select_variation_table_1 ORDER BY ref_id NULLS LAST;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1001 | name-1001 |  60000.00 |      1 |       1002
 1002 | name-1002 |  75000.00 |      1 |       1000
 1003 | name-1003 |  50000.00 |      2 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1005 | name-1005 |  80000.00 |      3 |       1000
 1000 | name-1000 | 100000.00 |        |           
(6 rows)

--- GROUP BY
SELECT ref_id, COUNT(*), SUM(value)
  FROM fdw_select_variation_table_1
  GROUP BY ref_id
  ORDER BY ref_id;
 ref_id | count |    sum    
--------+-------+-----------
        |     1 | 100000.00
      1 |     2 | 135000.00
      2 |     1 |  50000.00
      3 |     2 | 135000.00
(4 rows)

--- GROUP BY ALL
SELECT ref_id, COUNT(*), SUM(value)
  FROM fdw_select_variation_table_1
  GROUP BY ALL ref_id
  ORDER BY ref_id;
 ref_id | count |    sum    
--------+-------+-----------
        |     1 | 100000.00
      1 |     2 | 135000.00
      2 |     1 |  50000.00
      3 |     2 | 135000.00
(4 rows)

--- GROUP BY DISTINCT
SELECT ref_id, COUNT(*), SUM(value)
  FROM fdw_select_variation_table_1
  GROUP BY DISTINCT ref_id
  ORDER BY ref_id;
 ref_id | count |    sum    
--------+-------+-----------
        |     1 | 100000.00
      1 |     2 | 135000.00
      2 |     1 |  50000.00
      3 |     2 | 135000.00
(4 rows)

--- HAVING
SELECT ref_id, COUNT(*), SUM(value)
  FROM fdw_select_variation_table_1
  GROUP BY ref_id
  HAVING COUNT(*) >= 2;
 ref_id | count |    sum    
--------+-------+-----------
      1 |     2 | 135000.00
      3 |     2 | 135000.00
(2 rows)

--- WINDOW
SELECT id, name, value, RANK() OVER w AS rk
  FROM fdw_select_variation_table_1
  WINDOW w AS (ORDER BY value DESC);
  id  |   name    |   value   | rk 
------+-----------+-----------+----
 1000 | name-1000 | 100000.00 |  1
 1005 | name-1005 |  80000.00 |  2
 1002 | name-1002 |  75000.00 |  3
 1001 | name-1001 |  60000.00 |  4
 1004 | name-1004 |  55000.00 |  5
 1003 | name-1003 |  50000.00 |  6
(6 rows)

--- UNION
SELECT * FROM fdw_select_variation_table_1 UNION SELECT * FROM fdw_select_variation_table_1;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1001 | name-1001 |  60000.00 |      1 |       1002
 1002 | name-1002 |  75000.00 |      1 |       1000
 1003 | name-1003 |  50000.00 |      2 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1005 | name-1005 |  80000.00 |      3 |       1000
(6 rows)

SELECT * FROM fdw_select_variation_table_1 UNION SELECT * FROM fdw_select_variation_table_1 ORDER BY value DESC;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1005 | name-1005 |  80000.00 |      3 |       1000
 1002 | name-1002 |  75000.00 |      1 |       1000
 1001 | name-1001 |  60000.00 |      1 |       1002
 1004 | name-1004 |  55000.00 |      3 |       1005
 1003 | name-1003 |  50000.00 |      2 |       1005
(6 rows)

SELECT * FROM fdw_select_variation_table_1 WHERE value>=60000
  UNION SELECT * FROM fdw_select_variation_table_1 WHERE manager_id=1000 ORDER BY value DESC;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1005 | name-1005 |  80000.00 |      3 |       1000
 1002 | name-1002 |  75000.00 |      1 |       1000
 1001 | name-1001 |  60000.00 |      1 |       1002
(4 rows)

--- UNION ALL
SELECT * FROM fdw_select_variation_table_1 UNION ALL SELECT * FROM fdw_select_variation_table_1;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1001 | name-1001 |  60000.00 |      1 |       1002
 1002 | name-1002 |  75000.00 |      1 |       1000
 1003 | name-1003 |  50000.00 |      2 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1005 | name-1005 |  80000.00 |      3 |       1000
 1000 | name-1000 | 100000.00 |        |           
 1001 | name-1001 |  60000.00 |      1 |       1002
 1002 | name-1002 |  75000.00 |      1 |       1000
 1003 | name-1003 |  50000.00 |      2 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1005 | name-1005 |  80000.00 |      3 |       1000
(12 rows)

SELECT * FROM fdw_select_variation_table_1
  UNION ALL SELECT * FROM fdw_select_variation_table_1 ORDER BY value DESC;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1000 | name-1000 | 100000.00 |        |           
 1005 | name-1005 |  80000.00 |      3 |       1000
 1005 | name-1005 |  80000.00 |      3 |       1000
 1002 | name-1002 |  75000.00 |      1 |       1000
 1002 | name-1002 |  75000.00 |      1 |       1000
 1001 | name-1001 |  60000.00 |      1 |       1002
 1001 | name-1001 |  60000.00 |      1 |       1002
 1004 | name-1004 |  55000.00 |      3 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1003 | name-1003 |  50000.00 |      2 |       1005
 1003 | name-1003 |  50000.00 |      2 |       1005
(12 rows)

SELECT * FROM fdw_select_variation_table_1 WHERE value>=60000
  UNION ALL SELECT * FROM fdw_select_variation_table_1 WHERE manager_id=1000 ORDER BY value DESC;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1005 | name-1005 |  80000.00 |      3 |       1000
 1005 | name-1005 |  80000.00 |      3 |       1000
 1002 | name-1002 |  75000.00 |      1 |       1000
 1002 | name-1002 |  75000.00 |      1 |       1000
 1001 | name-1001 |  60000.00 |      1 |       1002
(6 rows)

--- UNION DISTINCT
SELECT ref_id, name FROM fdw_select_variation_table_1
  UNION DISTINCT SELECT id, name FROM fdw_select_variation_table_2 ORDER BY ref_id, name;
 ref_id |   name    
--------+-----------
      1 | dep-1
      1 | name-1001
      1 | name-1002
      2 | dep-2
      2 | name-1003
      3 | dep-3
      3 | name-1004
      3 | name-1005
      4 | dep-4
        | name-1000
(10 rows)

--- INTERSECT
SELECT ref_id FROM fdw_select_variation_table_1
  INTERSECT SELECT id FROM fdw_select_variation_table_2 ORDER BY ref_id;
 ref_id 
--------
      1
      2
      3
(3 rows)

--- INTERSECT ALL
SELECT ref_id FROM fdw_select_variation_table_1
  INTERSECT ALL SELECT id FROM fdw_select_variation_table_2 ORDER BY ref_id;
 ref_id 
--------
      1
      2
      3
(3 rows)

--- INTERSECT DISTINCT
SELECT ref_id FROM fdw_select_variation_table_1
  INTERSECT DISTINCT SELECT id FROM fdw_select_variation_table_2 ORDER BY ref_id;
 ref_id 
--------
      1
      2
      3
(3 rows)

--- EXCEPT
SELECT ref_id FROM fdw_select_variation_table_1
  EXCEPT SELECT id FROM fdw_select_variation_table_2 ORDER BY ref_id;
 ref_id 
--------
       
(1 row)

--- EXCEPT ALL
SELECT ref_id FROM fdw_select_variation_table_1
  EXCEPT ALL SELECT id FROM fdw_select_variation_table_2 ORDER BY ref_id;
 ref_id 
--------
      1
      3
       
(3 rows)

--- EXCEPT DISTINCT
SELECT ref_id FROM fdw_select_variation_table_1
  EXCEPT DISTINCT SELECT id FROM fdw_select_variation_table_2 ORDER BY ref_id;
 ref_id 
--------
       
(1 row)

--- LIMIT
SELECT * FROM fdw_select_variation_table_1 LIMIT 2;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1001 | name-1001 |  60000.00 |      1 |       1002
(2 rows)

--- LIMIT ALL
SELECT * FROM fdw_select_variation_table_1 LIMIT ALL;
  id  |   name    |   value   | ref_id | manager_id 
------+-----------+-----------+--------+------------
 1000 | name-1000 | 100000.00 |        |           
 1001 | name-1001 |  60000.00 |      1 |       1002
 1002 | name-1002 |  75000.00 |      1 |       1000
 1003 | name-1003 |  50000.00 |      2 |       1005
 1004 | name-1004 |  55000.00 |      3 |       1005
 1005 | name-1005 |  80000.00 |      3 |       1000
(6 rows)

--- LIMIT OFFSET
SELECT * FROM fdw_select_variation_table_1 LIMIT 2 OFFSET 1;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the query on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "OFFSET", expected one of {<END_OF_FILE>, %, *, +, -, ...}" region:"region(begin=85, end=91)")
CONTEXT:  SQL query: SELECT id, name, value, ref_id, manager_id FROM fdw_select_variation_table_1 LIMIT 2 OFFSET 1
--- FETCH FIRST ... WITH TIES
SELECT * FROM fdw_select_variation_table_1 ORDER BY value FETCH FIRST 2 ROWS WITH TIES;
  id  |   name    |  value   | ref_id | manager_id 
------+-----------+----------+--------+------------
 1003 | name-1003 | 50000.00 |      2 |       1005
 1004 | name-1004 | 55000.00 |      3 |       1005
(2 rows)

--- FETCH FIRST ... ONLY
SELECT * FROM fdw_select_variation_table_1 ORDER BY value FETCH FIRST 2 ROWS ONLY;
  id  |   name    |  value   | ref_id | manager_id 
------+-----------+----------+--------+------------
 1003 | name-1003 | 50000.00 |      2 |       1005
 1004 | name-1004 | 55000.00 |      3 |       1005
(2 rows)

--- FETCH NEXT ... WITH TIES
SELECT * FROM fdw_select_variation_table_1 ORDER BY value FETCH NEXT 2 ROWS WITH TIES;
  id  |   name    |  value   | ref_id | manager_id 
------+-----------+----------+--------+------------
 1003 | name-1003 | 50000.00 |      2 |       1005
 1004 | name-1004 | 55000.00 |      3 |       1005
(2 rows)

--- FETCH NEXT ... ONLY
SELECT * FROM fdw_select_variation_table_1 ORDER BY value FETCH NEXT 2 ROWS ONLY;
  id  |   name    |  value   | ref_id | manager_id 
------+-----------+----------+--------+------------
 1003 | name-1003 | 50000.00 |      2 |       1005
 1004 | name-1004 | 55000.00 |      3 |       1005
(2 rows)

--- OFFSET FETCH FIRST ... WITH TIES
SELECT * FROM fdw_select_variation_table_1 ORDER BY value OFFSET 1 FETCH FIRST 2 ROWS WITH TIES;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the query on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "OFFSET", expected one of {<END_OF_FILE>, %, *, +, -, ...}" region:"region(begin=104, end=110)")
CONTEXT:  SQL query: SELECT id, name, value, ref_id, manager_id FROM fdw_select_variation_table_1 ORDER BY value ASC LIMIT 2 OFFSET 1
--- OFFSET FETCH FIRST ... ONLY
SELECT * FROM fdw_select_variation_table_1 ORDER BY value OFFSET 1 FETCH FIRST 2 ROWS ONLY;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the query on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "OFFSET", expected one of {<END_OF_FILE>, %, *, +, -, ...}" region:"region(begin=104, end=110)")
CONTEXT:  SQL query: SELECT id, name, value, ref_id, manager_id FROM fdw_select_variation_table_1 ORDER BY value ASC LIMIT 2 OFFSET 1
--- OFFSET FETCH NEXT ... WITH TIES
SELECT * FROM fdw_select_variation_table_1 ORDER BY value OFFSET 1 FETCH NEXT 2 ROWS WITH TIES;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the query on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "OFFSET", expected one of {<END_OF_FILE>, %, *, +, -, ...}" region:"region(begin=104, end=110)")
CONTEXT:  SQL query: SELECT id, name, value, ref_id, manager_id FROM fdw_select_variation_table_1 ORDER BY value ASC LIMIT 2 OFFSET 1
--- OFFSET FETCH NEXT ... ONLY
SELECT * FROM fdw_select_variation_table_1 ORDER BY value OFFSET 1 FETCH NEXT 2 ROWS ONLY;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the query on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "OFFSET", expected one of {<END_OF_FILE>, %, *, +, -, ...}" region:"region(begin=104, end=110)")
CONTEXT:  SQL query: SELECT id, name, value, ref_id, manager_id FROM fdw_select_variation_table_1 ORDER BY value ASC LIMIT 2 OFFSET 1
--- SELECT FOR UPDATE / NOWAIT
BEGIN;
SELECT * FROM fdw_select_variation_table_1 FOR UPDATE NOWAIT;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the query on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "FOR", expected one of {<END_OF_FILE>, ,, ., ;, AS, ...}" region:"region(begin=77, end=80)")
CONTEXT:  SQL query: SELECT id, name, value, ref_id, manager_id FROM fdw_select_variation_table_1 FOR UPDATE
END;
--- SELECT FOR UPDATE / SKIP LOCKED
BEGIN;
SELECT * FROM fdw_select_variation_table_1 FOR UPDATE SKIP LOCKED;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the query on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "FOR", expected one of {<END_OF_FILE>, ,, ., ;, AS, ...}" region:"region(begin=77, end=80)")
CONTEXT:  SQL query: SELECT id, name, value, ref_id, manager_id FROM fdw_select_variation_table_1 FOR UPDATE
END;
-- Test teardown: DDL of the PostgreSQL
DROP FOREIGN TABLE fdw_select_variation_table_1;
DROP FOREIGN TABLE fdw_select_variation_table_2;
-- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_select_variation_table_1', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

SELECT tg_execute_ddl('DROP TABLE fdw_select_variation_table_2', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

/* Test case: INSERT statement variations */
-- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_ins_variation_table (
    id INT PRIMARY KEY DEFAULT 9999,
    key_col VARCHAR(100) DEFAULT ''default'',
    value_col INT DEFAULT 0
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

-- Test setup: DDL of the PostgreSQL
CREATE FOREIGN TABLE fdw_ins_variation_table (
  id INT,
  key_col TEXT,
  value_col INT
) SERVER tsurugidb;
-- Test
--- WITH
WITH data AS (
  SELECT 'key1'::TEXT AS key_col, 100 AS value_col
)
INSERT INTO fdw_ins_variation_table (id, key_col, value_col) SELECT 1, key_col, value_col FROM data;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "INSERT", expected one of {(, ,, SELECT, TABLE}" region:"region(begin=68, end=74)")
CONTEXT:  SQL query: WITH data AS (
  SELECT 'key1'::TEXT AS key_col, 100 AS value_col
)
INSERT INTO fdw_ins_variation_table (id, key_col, value_col) SELECT 1, key_col, value_col FROM data
--- INSERT ... AS alias
INSERT INTO fdw_ins_variation_table AS it (id, key_col, value_col) VALUES (2, 'key2', 200);
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "AS", expected one of {(, ., DEFAULT, SELECT, TABLE, ...}" region:"region(begin=36, end=38)")
CONTEXT:  SQL query: INSERT INTO fdw_ins_variation_table AS it (id, key_col, value_col) VALUES (2, 'key2', 200)
--- DEFAULT VALUES
INSERT INTO fdw_ins_variation_table DEFAULT VALUES;
SELECT * FROM fdw_ins_variation_table;
  id  | key_col | value_col 
------+---------+-----------
 9999 | default |         0
(1 row)

INSERT INTO fdw_ins_variation_table VALUES (3, 'key3', DEFAULT);
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: VALUE_ANALYZE_EXCEPTION (SQL-03005: compile failed with error:missing_context_of_default_value message:"cannot use 'DEFAULT' here" location:<input>:1:56+7)
CONTEXT:  SQL query: INSERT INTO fdw_ins_variation_table VALUES (3, 'key3', DEFAULT)
--- INSERT ... VALUES (...), ...
INSERT INTO fdw_ins_variation_table VALUES (4, 'key4', 400), (5, 'key5', 500);
SELECT * FROM fdw_ins_variation_table;
  id  | key_col | value_col 
------+---------+-----------
    4 | key4    |       400
    5 | key5    |       500
 9999 | default |         0
(3 rows)

--- INSERT ... SELECT
INSERT INTO fdw_ins_variation_table SELECT 6, 'key6', 600;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: UNSUPPORTED_COMPILER_FEATURE_EXCEPTION (SQL-03010: compile failed with error:unsupported_feature message:"values operator is unsupported" location:(unknown))
CONTEXT:  SQL query: INSERT INTO fdw_ins_variation_table SELECT 6, 'key6', 600
--- ON CONFLICT DO NOTHING
INSERT INTO fdw_ins_variation_table VALUES (4, 'key4', 777) ON CONFLICT (id) DO NOTHING;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "ON", expected one of {<END_OF_FILE>, ,, ;, EXCEPT, INTERSECT, ...}" region:"region(begin=60, end=62)")
CONTEXT:  SQL query: INSERT INTO fdw_ins_variation_table VALUES (4, 'key4', 777) ON CONFLICT (id) DO NOTHING
--- ON CONFLICT DO UPDATE SET ...
INSERT INTO fdw_ins_variation_table (key_col, value_col) VALUES ('key4', 444)
  ON CONFLICT (key_col) DO UPDATE SET value_col = EXCLUDED.value_col;
ERROR:  there is no unique or exclusion constraint matching the ON CONFLICT specification
--- RETURNING
INSERT INTO fdw_ins_variation_table (key_col, value_col) VALUES ('key6', 600)
  RETURNING id, key_col AS inserted_key;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "RETURNING", expected one of {<END_OF_FILE>, ,, ;, EXCEPT, INTERSECT, ...}" region:"region(begin=80, end=89)")
CONTEXT:  SQL query: INSERT INTO fdw_ins_variation_table (key_col, value_col) VALUES ('key6', 600)
  RETURNING id, key_col AS inserted_key
-- Test teardown: DDL of the PostgreSQL
DROP FOREIGN TABLE fdw_ins_variation_table;
-- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_ins_variation_table', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

/* Test case: UPDATE statement variations */
-- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_upd_variation_table_1 (
    id INT PRIMARY KEY,
    key_col VARCHAR(100),
    value_col INT DEFAULT 0
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

SELECT tg_execute_ddl('
  CREATE TABLE fdw_upd_variation_table_2 (
    key_col VARCHAR(100),
    add_val INT
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

-- Test setup: DDL of the PostgreSQL
CREATE FOREIGN TABLE fdw_upd_variation_table_1 (
  id INT,
  key_col TEXT,
  value_col INT DEFAULT 0
) SERVER tsurugidb;
CREATE FOREIGN TABLE fdw_upd_variation_table_2 (
  key_col TEXT,
  add_val INT
) SERVER tsurugidb;
-- Initialization of test data
INSERT INTO fdw_upd_variation_table_1
  (id, key_col, value_col) VALUES
  (1, 'key1', 10),
  (2, 'key2', 20),
  (3, 'key3', 30);
INSERT INTO fdw_upd_variation_table_2
  (key_col, add_val) VALUES
  ('key3', 5);
-- Test
--- WITH
WITH upd_data AS (
  SELECT 'key1'::TEXT AS key_col, 100 AS new_val
)
UPDATE fdw_upd_variation_table_1 SET value_col = upd_data.new_val
  FROM upd_data WHERE fdw_upd_variation_table_1.key_col = upd_data.key_col;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "UPDATE", expected one of {(, ,, SELECT, TABLE}" region:"region(begin=70, end=76)")
CONTEXT:  SQL query: WITH upd_data AS (
  SELECT 'key1'::TEXT AS key_col, 100 AS new_val
)
UPDATE fdw_upd_variation_table_1 SET value_col = upd_data.new_val
  FROM upd_data WHERE fdw_upd_variation_table_1.key_col = upd_data.key_col
--- ONLY
UPDATE ONLY fdw_upd_variation_table_1 SET value_col = 111 WHERE key_col = 'key1';
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "ONLY", expected one of {ASC, DESC, FIRST, IGNORE, KEY, ...}" region:"region(begin=7, end=11)")
CONTEXT:  SQL query: UPDATE ONLY fdw_upd_variation_table_1 SET value_col = 111 WHERE key_col = 'key1'
--- AS alias
UPDATE fdw_upd_variation_table_1 ut SET value_col = 222 WHERE ut.key_col = 'key2';
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "ut", expected one of {.}" region:"region(begin=33, end=35)")
CONTEXT:  SQL query: UPDATE fdw_upd_variation_table_1 ut SET value_col = 222 WHERE ut.key_col = 'key2'
UPDATE fdw_upd_variation_table_1 AS ut SET value_col = 222 WHERE ut.key_col = 'key2';
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "AS", expected one of {.}" region:"region(begin=33, end=35)")
CONTEXT:  SQL query: UPDATE fdw_upd_variation_table_1 AS ut SET value_col = 222 WHERE ut.key_col = 'key2'
--- SET column_name = expression
UPDATE fdw_upd_variation_table_1 SET value_col = value_col + 10 WHERE key_col = 'key3';
SELECT * FROM fdw_upd_variation_table_1;
 id | key_col | value_col 
----+---------+-----------
  1 | key1    |        10
  2 | key2    |        20
  3 | key3    |        40
(3 rows)

--- SET column_name = DEFAULT
UPDATE fdw_upd_variation_table_1 SET value_col = DEFAULT WHERE key_col = 'key3';
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: VALUE_ANALYZE_EXCEPTION (SQL-03005: compile failed with error:missing_context_of_default_value message:"cannot use 'DEFAULT' here" location:<input>:1:50+7)
CONTEXT:  SQL query: UPDATE fdw_upd_variation_table_1 SET value_col = DEFAULT WHERE key_col = 'key3'
--- SET (col1, col2) = ROW (...)
UPDATE fdw_upd_variation_table_1
  SET (key_col, value_col) = ROW('key1_modified', 123) WHERE key_col = 'key1';
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "(", expected one of {ASC, DESC, FIRST, IGNORE, KEY, ...}" region:"region(begin=39, end=40)")
CONTEXT:  SQL query: UPDATE fdw_upd_variation_table_1
  SET (key_col, value_col) = ROW('key1_modified', 123) WHERE key_col = 'key1'
--- SET (col1, col2) = (sub-SELECT)
UPDATE fdw_upd_variation_table_1
  SET (key_col, value_col) = (SELECT 'key2_modified', 222) WHERE key_col = 'key2';
ERROR:  unrecognized paramkind: 3
--- UPDATE ... FROM
UPDATE fdw_upd_variation_table_1
  SET value_col = value_col + fdw_upd_variation_table_2.add_val
    FROM fdw_upd_variation_table_2
    WHERE fdw_upd_variation_table_1.key_col = fdw_upd_variation_table_2.key_col;
NOTICE:  PostgreSQL unique grammar.(there is a FROM clause in UPDATE or DELETE)
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "FROM", expected one of {<END_OF_FILE>, %, (, *, +, ...}" region:"region(begin=101, end=105)")
CONTEXT:  SQL query: UPDATE fdw_upd_variation_table_1
  SET value_col = value_col + fdw_upd_variation_table_2.add_val
    FROM fdw_upd_variation_table_2
    WHERE fdw_upd_variation_table_1.key_col = fdw_upd_variation_table_2.key_col
--- RETURNING
UPDATE fdw_upd_variation_table_1 SET value_col = value_col + 1 WHERE key_col = 'key3'
  RETURNING id, key_col AS updated_key, value_col;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "RETURNING", expected one of {<END_OF_FILE>, %, *, +, -, ...}" region:"region(begin=88, end=97)")
CONTEXT:  SQL query: UPDATE fdw_upd_variation_table_1 SET value_col = value_col + 1 WHERE key_col = 'key3'
  RETURNING id, key_col AS updated_key, value_col
-- Test teardown: DDL of the PostgreSQL
DROP FOREIGN TABLE fdw_upd_variation_table_1;
DROP FOREIGN TABLE fdw_upd_variation_table_2;
-- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_upd_variation_table_1', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

SELECT tg_execute_ddl('DROP TABLE fdw_upd_variation_table_2', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

/* Test case: DELETE statement variations */
-- Test setup: DDL of the Tsurugi
SELECT tg_execute_ddl('
  CREATE TABLE fdw_del_variation_table_1 (
    id INT PRIMARY KEY,
    key_col VARCHAR(100),
    value_col INT
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

SELECT tg_execute_ddl('
  CREATE TABLE fdw_del_variation_table_2 (
    key_col VARCHAR(100)
  )
', 'tsurugidb');
 tg_execute_ddl 
----------------
 CREATE TABLE
(1 row)

-- Test setup: DDL of the PostgreSQL
CREATE FOREIGN TABLE fdw_del_variation_table_1 (
  id INT,
  key_col TEXT,
  value_col INT
) SERVER tsurugidb;
CREATE FOREIGN TABLE fdw_del_variation_table_2 (
  key_col TEXT
) SERVER tsurugidb;
-- Initialization of test data
INSERT INTO fdw_del_variation_table_1
  (id, key_col, value_col) VALUES
  (1, 'key1', 10),
  (2, 'key2', 20),
  (3, 'key3', 30),
  (4, 'key4', 40),
  (5, 'key5', 50),
  (6, 'key5', 60);
INSERT INTO fdw_del_variation_table_2
  (key_col) VALUES
  ('key4'), ('key5');
-- Test
--- WITH
WITH keys_to_delete AS (
  SELECT 'key1'::TEXT AS key_col
)
DELETE FROM fdw_del_variation_table_1
  USING keys_to_delete WHERE fdw_del_variation_table_1.key_col = keys_to_delete.key_col;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "DELETE", expected one of {(, ,, SELECT, TABLE}" region:"region(begin=60, end=66)")
CONTEXT:  SQL query: WITH keys_to_delete AS (
  SELECT 'key1'::TEXT AS key_col
)
DELETE FROM fdw_del_variation_table_1
  USING keys_to_delete WHERE fdw_del_variation_table_1.key_col = keys_to_delete.key_col
--- ONLY
DELETE FROM ONLY fdw_del_variation_table_1 WHERE key_col = 'key1';
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "ONLY", expected one of {ASC, DESC, FIRST, IGNORE, KEY, ...}" region:"region(begin=12, end=16)")
CONTEXT:  SQL query: DELETE FROM ONLY fdw_del_variation_table_1 WHERE key_col = 'key1'
--- AS alias
DELETE FROM fdw_del_variation_table_1 dt WHERE dt.key_col = 'key2';
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "dt", expected one of {<END_OF_FILE>, ., ;}" region:"region(begin=38, end=40)")
CONTEXT:  SQL query: DELETE FROM fdw_del_variation_table_1 dt WHERE dt.key_col = 'key2'
DELETE FROM fdw_del_variation_table_1 AS dt WHERE dt.key_col = 'key3';
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "AS", expected one of {<END_OF_FILE>, ., ;}" region:"region(begin=38, end=40)")
CONTEXT:  SQL query: DELETE FROM fdw_del_variation_table_1 AS dt WHERE dt.key_col = 'key3'
--- USING
DELETE FROM fdw_del_variation_table_1
  USING fdw_del_variation_table_2
    WHERE fdw_del_variation_table_1.key_col = fdw_del_variation_table_2.key_col;
NOTICE:  PostgreSQL unique grammar.(there is a FROM clause in UPDATE or DELETE)
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "USING", expected one of {<END_OF_FILE>, ., ;}" region:"region(begin=40, end=45)")
CONTEXT:  SQL query: DELETE FROM fdw_del_variation_table_1
  USING fdw_del_variation_table_2
    WHERE fdw_del_variation_table_1.key_col = fdw_del_variation_table_2.key_col
--- RETURNING
DELETE FROM fdw_del_variation_table_1 WHERE key_col = 'key6'
  RETURNING id, key_col AS deleted_key;
ERROR:  Failed to execute remote SQL.
HINT:  Failed to execute the statement on Tsurugi. error: SERVER_ERROR(13)
Tsurugi Error: SYNTAX_EXCEPTION (SQL-03001: compile failed with message:"appeared unexpected token: "RETURNING", expected one of {<END_OF_FILE>, %, *, +, -, ...}" region:"region(begin=63, end=72)")
CONTEXT:  SQL query: DELETE FROM fdw_del_variation_table_1 WHERE key_col = 'key6'
  RETURNING id, key_col AS deleted_key
-- Test teardown: DDL of the PostgreSQL
DROP FOREIGN TABLE fdw_del_variation_table_1;
DROP FOREIGN TABLE fdw_del_variation_table_2;
-- Test teardown: DDL of the Tsurugi
SELECT tg_execute_ddl('DROP TABLE fdw_del_variation_table_1', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

SELECT tg_execute_ddl('DROP TABLE fdw_del_variation_table_2', 'tsurugidb');
 tg_execute_ddl 
----------------
 DROP TABLE
(1 row)

